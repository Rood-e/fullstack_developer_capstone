name: 'Lint Code'

on:
  push:
    branches: [master, main]
  pull_request:
    branches: [master, main]

jobs: # Inizio della sezione "jobs" (lavori)

  lint_python:
    name: Lint Python Files (Flake8)
    runs-on: ubuntu-latest
    steps:
    - name: Checkout Repository
      uses: actions/checkout@v3
        
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: 3.12
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install flake8
        
    - name: Run Linter
      run: |
        # Esegue flake8, escludendo cartelle non necessarie
        flake8 . --exclude=migrations,__pycache__,venv,node_modules
        echo "Linted all the python files successfully"

  # ---

  lint_js:
    name: Lint JavaScript Files (ESLint)
    runs-on: ubuntu-latest
    steps:
    - name: Checkout Repository
      uses: actions/checkout@v3
      
    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        # Usa una versione LTS moderna per supportare ES6/ES8
        node-version: 20
        
    - name: Install Dependencies and ESLint
      # Installazione globale di ESLint e del plugin React
      run: |
        npm install -g eslint
        npm install -g eslint-plugin-react
        
    - name: Create ESLint Configuration File
      run: |
        # Crea il file .eslintrc.json per configurare ESLint
        # Questo risolve gli errori di sintassi moderni (ES6/ES8/React)
        echo '{
          "env": {
            "browser": true,
            "node": true,
            "es2020": true,
            "jest": true
          },
          "extends": [
            "eslint:recommended",
            "plugin:react/recommended"
          ],
          "parserOptions": {
            "ecmaVersion": 2020,
            "sourceType": "module",
            "ecmaFeatures": {
              "jsx": true
            }
          },
          "rules": {
            "semi": ["error", "always"],
            "no-unused-vars": "warn",
            "react/prop-types": "off",
            "quotes": ["error", "double"],
            "prefer-const": "error",
            "dot-notation": "off"
          },
          "settings": {
            "react": {
              "version": "detect"
            }
          }
        }' > .eslintrc.json
        
    - name: Run Linter
      run: |
        # Esegue ESLint, utilizzando la configurazione appena creata.
        # Usa l'opzione --ignore-pattern per saltare node_modules e risolvere l'errore precedente.
        eslint . --ext .js --ignore-pattern "**/node_modules/**"
        echo "Linted all the js files successfully"
